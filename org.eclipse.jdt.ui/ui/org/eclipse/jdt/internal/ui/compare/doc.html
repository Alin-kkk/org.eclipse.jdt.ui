<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="GENERATOR" content="Mozilla/4.75 [en] (WinNT; U) [Netscape]">
</head>
<body>

<h1>
The Java Compare Example</h1>

<h2>
Objective</h2>
This example demonstrates the following concepts and features:
<ul>
<li>
How to compare arbitrary resource structures in Eclipse,</li>

<li>
How to drill down into the differences of the internal structure of resources
(here: the structure of Java source),</li>

<li>
How to extend the Compare plugin for new resource types (here: JavaCompare).</li>
</ul>
Note: The <b>JavaCompare</b> plugin is for demonstration purposes only!
Java compare support will be provided by the <b>Eclipse Java Tooling</b>.
<h2>
Introduction: Comparing in Eclipse</h2>
The compare plugin of Eclipse supports two-way (or three-way) compare for
workbench resources. It tries to ensure&nbsp; "good quality" of the compare
results (that is it finds only the "real" differences and minimizes the
number of false matches) by employing structural knowledge about the contents
of a resource. This includes the ability to ignore non-relevant syntactic
entities like whitespace and comments when comparing contents.
<p>So if the methods in a Java source file have been rearranged and indented
without touching the method bodies, a textual compare would show a large
number of almost useless differences while a structural compare would show
no differences at all!
<p>To let the user choose between a textual and a structural point of view
the Compare UI uses a simple browser metaphor to present compare results:
a bottom pane shows the differences between the contents of the two (or
three) compared resources; if the compare plugin understands the structure
of the compared input elements, their structural differences are shown
in additional panes at the top of the browser.
<p>Because the compare results can be modified (e.g. as part of a merge
operation) the browser panes from above live in an Eclipse content editor:
the Compare Editor. The editor's content represents a buffered snapshot
of a Compare operation. Modifications to any of the resources involved
in the compare are performed on the buffer only. If the Compare Editor
is saved all modified buffers are written back to their resources on disk.
<p>The current Compare Editor:
<ul>
<li>
supports at most three panes for structural viewers and one pane for a
content viewer,</li>

<li>
has the following builtin structure viewers:</li>

<ul>
<li>
resource containers (projects, files, and folders),</li>

<li>
jar-files (extension "jar"),</li>

<li>
property files (extension "properties").</li>
</ul>

<li>
has the following builtin content viewers:</li>

<ul>
<li>
text (extension "txt"),</li>

<li>
images (extension "gif").</li>
</ul>
</ul>
The JavaCompare plugin adds the following Java specific viewers:
<ul>
<li>
a structure viewer for Java compilation units (files with extension "java"),</li>

<li>
a content differences viewer with the same features as the JavaEditor provided
by the JavaEditor plugin (syntax highlighting, fake code assist, etc.).</li>
</ul>

<h2>
Running Compare</h2>
Before you begin you must first open the desktop and ensure that you have
a project containing some pairs of "similar" resources, i.e.
<ul>
<li>
two files containing plain text (extension "txt"),</li>

<li>
two Java files,</li>

<li>
two image files,</li>

<li>
two folder hierarchies with Java source code, property files, images, and
plain text resources,</li>

<li>
two jar files containing a folder hierarchy like above.</li>
</ul>
Although you can compare two arbitrarily resources or resource hierarchies
Compare works best if the input elements are similar, that is if one has
been derived from the other by applying a small number of changes.
<ol>
<li>
In the resource navigator select any two files or two folders,</li>

<li>
from the context menu select <b>Compare.</b></li>
</ol>
A <b>Compare Editor</b> with one to four panes opens:
<ul>
<li>
the top level panes show structural differences (if any). They come and
go as needed.</li>

<li>
the bottom pane shows content differences. If you compare two plain text
files no structural differences are found and the content pane fills the
Compare Editor completely.</li>
</ul>
Try to compare two folders containing two jar files containing Java source
code and drill down. This fills all 4 panes (the maximum).
<p>The contents of the content pane is always determined by the current
selection in one of the structure panes. Always selecting leafs in the
rightmost structure pane ensures that the content pane's content is minimal.
<p>If the Compare Editor is active a compare specific button appears in
the desktop's toolbar (label "WS"). This button controls whether the structure
and content viewers in the current Compare Editor ignore whitespace when
performing the compare. A good example for this is Java source where only
the formatting has been changed: indent all methods, change assignment
operators from " = " to "= " etc.
<p>The text (or Java) compare viewer has three buttons in the top right
corner:
<ul>
<li>
The first button controls whether vertical scrolling is synchronized between
the left and right part of the viewer.</li>

<li>
The other two buttons select the next (previous) difference starting from
the current selection. They support two modes: if the selection lies within
a range of differing lines they find the next (previous) differing syntactic
element within that line range. If the selection is outside a range of
differing lines they select the next (previous) differing line range.</li>
</ul>
The Java structure viewer tries to detect method renames and method argument
list changes. Instead of showing an addition and a deletion for these cases
it creates a new synthetic (collapsed) node with the added and removed
nodes as children. Selecting the synthetic node shows the method contents
side by side in the content viewer. Expanding the node shows the two constituents.
<h2>
Concepts demonstrated by the JavaCompare Plugin</h2>
The Compare plugin defines two extension points. Both are used to register
a viewer factory for a given resource type. The factories must implement
the <tt>org.eclipse.ui.compare.mergeviewer.IViewerCreator</tt> interface
(This indirection by means of a factory is necessary because viewers cannot
have a default constructor in the new platform):
<ul>
<li>
<tt>org.eclipse.ui.compare.StructureMergeViewer</tt>:</li>

<br>This extension point is used to define a new <b>structure</b> viewer
for a given content type.
<br>&nbsp;
<li>
<tt>org.eclipse.ui.compare.ContentMergeViewer</tt>:</li>

<br>This extension point is used to define a new <b>content</b> viewer
for a given content type.</ul>
The JavaCompare plugin contributes a <tt>JavaStructureViewerCreator</tt>
and a <tt>JavaContentViewerCreator</tt> and the corresponding viewers <tt>JavaStructureViewer</tt>
and <tt>JavaContentViewer</tt> (package <tt>org.eclipse.examples.ui.javacompare</tt>).
<p>The <tt>JavaStructureViewer</tt>&nbsp; extends the <tt>StructureDiffViewer</tt>
of the Compare plugin by code which builds a partial parse tree of&nbsp;
Java input. The <tt>StructureDiffViewer</tt> calculates the differences
between two (or three) parse trees and displays them.
<p>The <tt>JavaContentViewer</tt> extends the generic <tt>TextMergeViewer</tt>
from the Compare plugin with a Java specific configuration (similar to
the Java Example Editor).
<br>&nbsp;
<h2>
Known Limitations and Problems</h2>

<ul>
<li>
Modification of the compare result (e.g. the result of merge) cannot be
saved back to the underlying resources.</li>

<li>
The compare plugin supports three-way compare but currently there is no
UI that lets you specify how a three element selection maps to the input
of the three-way compare. As a consequence there is no way to see the third
("common ancestor") part of a text or image merge viewer.</li>

<li>
Java comments are not considered whitespace. So they are not ignored when
switching to "Ignore whitespace" mode.</li>

<li>
No global navigation buttons in toolbar (next, previous).</li>

<li>
Some of the viewers optional functionality has no UI yet.</li>
</ul>

</body>
</html>
